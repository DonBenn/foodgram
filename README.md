#  Проект Foodgram для рецептов

## Развернутый проект

```
https://recipegram.sytes.net/
```

[![Main Foodgram workflow](https://github.com/DonBenn/foodgram/actions/workflows/main.yml/badge.svg)](https://github.com/DonBenn/foodgram/actions/workflows/main.yml)

## Описание

Проект для загрузки и размещения на сайте рецептов пользователей. Пользователь регистрируется, авторизуется на сайте, добавляет аватор. Пользователь может
создавать, редактировать свои рецепты, выбирая разные ингредиенты, тэги и фото рецепта. Другие пользователи тоже регистрируются и создают свои рецепты. Пользователь может подписываться на другого пользователя, и управлять своими подписками. Любые рецепты можно добавлять в избарнное и в список покупок. Список покупок это корзина в которую попадают все добавленные рецепты с их ингредиентами. Список покупок можно скачать в виде `.txt` файла, в котором складываются все находящиеся ингредиенты рецептов в корзине. На главной странице отображаются последние шесть добавленных рецептов на сайте, которые можно отфильтровать на выбор, по разным тэгам.

Foodgram в контейнерах, CI/CD с помощью GitHub Actions


## Основные возможности проекта


### Для авторизованных пользователей:

  - Доступна **Главная страница**.
  - Доступна страница другого пользователя.
  - Доступна страница отдельного **Рецепта**.
  - Доступна страница **Мои подписки**:
      
      - можно подписаться и отписаться на странице рецепта;
      - можно подписаться и отписаться на странице автора;
      - при подписке рецепты автора добавляются на страницу **Мои подписки** и удаляются оттуда при отказе от подписки.
  - Доступна страница **Избранное**:
      
      - на странице рецепта есть возможность добавить рецепт в список избранного и удалить его оттуда;
      - на любой странице со списком рецептов есть возможность добавить рецепт в список избранного и удалить его оттуда.
  - Доступна страница **Список покупок**:
      
      - на странице рецепта есть возможность добавить рецепт в список покупок и удалить его оттуда;
      - на любой странице со списком рецептов есть возможность добавить рецепт в список покупок и удалить его оттуда;
      - есть возможность выгрузить файл с перечнем и количеством необходимых ингредиентов для рецептов из **Списка покупок**;
      - ингредиенты в выгружаемом списке не повторяются, корректно подсчитывается общее количество для каждого ингредиента.
  - Доступна страница **Создать рецепт**:
      
      - есть возможность опубликовать свой рецепт;
      - есть возможность отредактировать и сохранить изменения в своём рецепте;
      - есть возможность удалить свой рецепт.
  - Доступна возможность **Изменить пароль**.
  - Доступна возможность изменить/удалить изображение **Профиля**.
  - Доступна возможность **Выйти из системы**.

### Для неавторизованных пользователей:

  - Доступна главная страница.
  - Доступна страница отдельного рецепта.
  - Доступна страница любого пользователя.
  - Доступна и работает форма входа.
  - Доступна и работает форма регистрации.

### Администратор и админ-зона:

  - Все модели выведены в админ-зону.
  - Для модели пользователей доступен поиск по имени и адресу электронной почты.
  - Для модели рецептов включен поиск по названию, автору и фильтрация по тегам.
  - На админ-странице рецепта отображается общее число добавлений этого рецепта в избранное.
    Для модели ингредиентов работает поиск по названию.


## Используемые технологии

- **Python 3.9**
- **Django 3.12**
- **Django REST Framework**
- **Djoser**
- **Nginx**
- **Gunicorn**
- **React**
- **База данных**: PostgreSQL.
- **Docker** Контейнеризация проекта:
  - Проект запущен на виртуальном сервере в Docker-контейнерах:
    - `nginx` для обработки запросов и раздачи статики.
    - `PostgreSQL` для базы данных.
    - `Django+Gunicorn` для бэкенда.
    - Отдельный контейнер для сборки фронтенд-ресурсов.
  - Статические файлы и медиа-файлы сохраняются в volumes.
- **Обновление проекта**: Автоматическое обновление Docker-образа из облачного хранилища.
- **Соответствие стандартам**: Код написан в соответствии с `PEP 8`.
- Также используется **CI/CD Github Actions Workflow.**


## Версии запуска

В проекте представленны две версии запуска. Первая версия описанна в файле 
`docker-compose.yml`, в ней новые образы билдятся при каждом запуске, это удобно для отладки.
Вторая версия представленна в файле `docker-compose.production.yml` . В этом конфиге запускаются уже готовые образы для контейнеров, которые не билдятся, а скачиваются с `Docker Hub`. Это используется в продакшене.

## Локальный запуск проекта

Клонировать репозиторий и перейти в него в командной строке:

```
git clone https://github.com/DonBenn/foodgram.git
```

```
cd backend
```

Cоздать и активировать виртуальное окружение:

```
python -m venv venv
```

```
source venv/Scripts/activate
```

Установить зависимости из файла `requirements.txt`:

```
python -m pip install --upgrade pip
```

```
pip install -r requirements.txt
```

Перейдите в директорию, где лежит файл `docker-compose.yml` и выполните команды:

Сборка образов и запуск контейнеров

```
docker compose up 
```

Выполнение миграций, cбор и копирование статики, загрузка готовых ингредиентов и тэгов
для базы данных - Не требуется. Всё это загружается в автоматическом режиме при выполнении
команды `docker compose up`



Запуск проекта в браузере

```
http://localhost:8000/
```


Перезапуск и пересборка образов

```
docker compose stop && docker compose up --build 
```

## Удаленное развертывание проекта на сервере


Клонировать репозиторий и перейти в него в командной строке:

```
git clone https://github.com/DonBenn/foodgram.git
```

Перейдите в директории для сборки образов и выполните команды:

В терминале в корне проекта `Foodgram` последовательно выполните команды из листинга; 
замените `username` на ваш логин на `Docker Hub`

```
cd frontend  
docker build -t username/foodgram_frontend . 
cd ../backend  
docker build -t username/foodgram_backend .
cd ../nginx  
docker build -t username/foodgram_nginx . 

```

Отправьте собранные образы фронтенда, бэкенда и `Nginx` на `Docker Hub`

```
docker push username/foodgram_frontend
docker push username/foodgram_backend
docker push username/foodgram_nginx
```

Запустите `Docker Compose` с этой конфигурацией на своём компьютере

```
docker compose -f docker-compose.production.yml up 
```

Примените миграции

```
docker compose -f docker-compose.production.yml exec backend python manage.py migrate
```

Подключитесь к удаленному серверу

Переместитесь в домашнюю директорию

```
cd
```

Устанавите `Docker Compose` на сервер, поочередно выполнив команды:

```
sudo apt update
sudo apt install curl
curl -fSL https://get.docker.com -o get-docker.sh
sudo sh ./get-docker.sh
sudo apt install docker-compose-plugin 
```

Запускаем `Docker Compose` на сервере

Перейдите в директорию `foodgram/`

Cоздайте на сервере пустой файл `docker-compose.production.yml` и с помощью 
редактора nano добавьте в него содержимое из локального `docker-compose.production.yml`

Скопируйте файл `.env` на сервер, в директорию `foodgram/`

Запустите `Docker Compose` в режиме демона

```
sudo docker compose -f docker-compose.production.yml up -d 
```

Проверьте, что все нужные контейнеры запущены:

```
sudo docker compose -f docker-compose.production.yml ps 
```

Выполните миграции, загрузите готовые ингредиенты и тэги, соберите статические файлы бэкенда и скопируйте их 
в `/backend_static/static/`

```
sudo docker compose -f docker-compose.production.yml exec backend python manage.py migrate
sudo docker compose -f docker-compose.production.yml exec backend python manage.py collectstatic
sudo docker compose -f docker-compose.production.yml exec backend cp -r /app/collected_static/. /backend_static/static/ 
sudo docker compose -f docker-compose.production.yml exec backend python manage.py loadcsv
```

На сервере в редакторе nano откройте конфиг `Nginx`:

```
nano /etc/nginx/sites-enabled/default
```

Измените настройки `location` в секции `server`

```
    location / {
        proxy_set_header Host $http_host;
        proxy_pass http://127.0.0.1:8000;
    }
```

Сохраните изменения 

```
sudo nginx -t 
```

Перезагрузите конфиг `Nginx` 

```
sudo service nginx reload
```

Откройте в браузере страницу вашего проекта — https://ваш_домен/



## Автор проекта

[Бессонов Денис](https://github.com/DonBenn)


